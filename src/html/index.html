<section class="section main-section">
  <div class="grid gap-6 grid-cols-1 md:grid-cols-3 mb-6">
    <div class="card">
      <div class="card-content">
        <div class="flex items-center justify-between">
          <div class="widget-label">
            <h3>
              Total Stok
            </h3>
            <h1 id="stok">
            </h1>
          </div>
          <span class="icon widget-icon text-blue-500"><i class="mdi mdi-database mdi-48px"></i></span>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-content">
        <div class="flex items-center justify-between">
          <div class="widget-label">
            <h3>
              Penjualan
            </h3>
            <h1 id="penjualan">

            </h1>
          </div>
          <span class="icon widget-icon text-green-500"><i class="mdi mdi-finance mdi-48px"></i></span>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-content">
        <div class="flex items-center justify-between">
          <div class="widget-label">
            <h3>
              Barang Masuk
            </h3>
            <h1 id="barangMasuk">

            </h1>
          </div>
          <span class="icon widget-icon text-yellow-500"><i class="mdi mdi-cart-plus mdi-48px"></i></span>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-content">
      <div class="flex items-center justify-between">
        <div class="widget-label">
          <h3>
            Barang Keluar
          </h3>
          <h1 id="barangKeluar">

          </h1>
        </div>
        <span class="icon widget-icon text-yellow-500"><i class="mdi mdi-cart-minus mdi-48px"></i></span>
      </div>
    </div>
  </div>
  </div>

  <div class="card mb-6">
    <header class="card-header">
      <p class="card-header-title">
        <span class="icon"><i class="mdi mdi-finance"></i></span>
        Performa
      </p>
      <a href="" class="card-header-icon">
        <span class="icon"><i class="mdi mdi-reload"></i></span>
      </a>
    </header>
    <div class="card-content">
      <div class="chart-area">
        <div class="h-full">
          <div class="chartjs-size-monitor">
            <div class="chartjs-size-monitor-expand">
              <div></div>
            </div>
            <div class="chartjs-size-monitor-shrink">
              <div></div>
            </div>
          </div>
          <canvas id="big-line-chart" width="2992" height="1000" class="chartjs-render-monitor block"
            style="height: 400px; width: 1197px;"></canvas>
        </div>
      </div>
    </div>
  </div>



  <div class="notification blue">
    <div class="flex flex-col md:flex-row items-center justify-between space-y-3 md:space-y-0">
      <div>
        <b>Barang Terbaru</b>
      </div>
      <button onclick="fetchBarang()" class="button green">
        <span class="icon"><i class="mdi mdi-eye"></i></span>
        <span>Tampilkan data</span>
      </button>
      <a id="exportBarangLink" download class="button green">
        <span class="icon"><i class="mdi mdi-download"></i></span>
        <span>Export barang</span>
      </a>
    </div>
  </div>

  <div class="card has-table">
    <header class="card-header">
      <p class="card-header-title">
        <span class="icon"><i class="mdi mdi-buffer"></i></span>
        Table barang
      </p>
    </header>

    <div class="card-content">
      <table>
        <thead>
          <tr>
            <th>Id</th>
            <th>Nama</th>
            <th>Stok</th>
            <th>Harga</th>
            <th>Kategori</th>
            <th>Created</th>
            <th>QRCode</th>
          </tr>
        </thead>
        <tbody id="barang-table-body">

        </tbody>
      </table>
      <div class="table-pagination">
        <div class="flex items-center justify-between">
          <div class="buttons" id="pagination-buttons"></div>
          <small id="page-info"></small>
        </div>
      </div>
    </div>
  </div>
</section>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
  async function cetakQRLabelPDF() {
    const { jsPDF } = window.jspdf;
    const qrImage = document.getElementById("qrImage");

    if (!qrImage || !qrImage.src) {
      alert("QR Code belum tersedia.");
      return;
    }

    const doc = new jsPDF({
      orientation: "landscape", // Lebar lebih dulu
      unit: "mm",
      format: [50, 30] // Ukuran label: 50mm x 30mm
    });

    const imgWidth = 20; // ukuran QR di PDF
    const imgHeight = 20;

    // Posisi QR pertama
    const x1 = 5;
    const y1 = 5;

    // Posisi QR kedua
    const x2 = 25;
    const y2 = 5;

    const img = new Image();
    img.crossOrigin = "Anonymous";
    img.src = qrImage.src;

    img.onload = function () {
      // Gambar dua QR di posisi berbeda
      doc.addImage(img, "PNG", x1, y1, imgWidth, imgHeight);
      doc.addImage(img, "PNG", x2, y2, imgWidth, imgHeight);

      doc.save("label-qr.pdf");
    };

    img.onerror = function () {
      alert("Gagal memuat gambar QR Code.");
    };
  }

  async function getQr(id) {
    try {
      const res = await fetch(`${API_URL}/cetak-qr/${id}`, {
        method: "GET",
        credentials: "include"
      });
      const result = await res.json()
      console.log(result)
      const qrImage = document.getElementById("qrImage");
      qrImage.src = result.qrCode
      cetakQRLabelPDF();
    } catch (err) {
      console.log(err)
      alert('gagal mencetak QR', + err.message)
    }
  }
</script>